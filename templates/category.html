{% extends "base.html" %}
{% block content %}

<!-- ==========================================================
     CATEGORY PAGE HEADER
     Shows the category name + quick access to the cart
========================================================== -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-capitalize">{{ category }} Collection</h2>

    <a href="{{ url_for('product.cart') }}" class="btn btn-outline-dark btn-sm">
        View Cart
    </a>
</div>


<!-- ==========================================================
     PRODUCT GRID — 4 columns on desktop, 2 on mobile
========================================================== -->
<div class="row g-4">

    {% if products %}
        {% for item in products %}

        <!-- Each product card -->
        <div class="col-6 col-md-3 fade-in">

            <div class="card product-card h-100 position-relative shadow-sm hover-lift">

                <!-- ======================================================
                     IMAGE SLIDER CONTAINER
                     Holds:
                       - All product images (JSON inside data-images)
                       - Main slide image
                       - Prev/Next navigation buttons
                     JS in main.js handles the animation
                ======================================================= -->
                <div class="product-img-container"
                     data-images='[
                        "{{ url_for("static", filename="images/products/" ~ item.image) }}",
                        "{{ url_for("static", filename="images/products/" ~ (item.image2 or item.image)) }}",
                        "{{ url_for("static", filename="images/products/" ~ (item.image3 or item.image)) }}"
                     ]'>

                    <!-- Main visible image (first frame of slider) -->
                    <img class="product-img-slide"
                         loading="lazy"
                         src="{{ url_for('static', filename='images/products/' ~ item.image) }}"
                         alt="{{ item.name }}">

                    <!-- Slide buttons (absolute positioned over image) -->
                    <button class="prod-slide-btn prod-prev">❮</button>
                    <button class="prod-slide-btn prod-next">❯</button>
                </div>

                <!-- ======================================================
                     STRETCHED LINK
                     Makes the *entire card* clickable while keeping
                     HTML accessible and SEO-friendly.
                ======================================================= -->
                <a class="stretched-link prod-card-link"
                   href="{{ url_for('product.product_detail', product_id=item['_id']|string) }}">
                </a>

                <!-- ======================================================
                     PRODUCT NAME + PRICE SECTION
                ======================================================= -->
                <div class="p-3">

                    <!-- Product title -->
                    <h6 class="mb-1 fw-semibold product-name">{{ item.name }}</h6>

                    <!-- If product has a discount, show full pricing layout -->
                    {% if item.discount and item.discount > 0 %}
                        {% set original = (item.price / (1 - (item.discount / 100))) | round(0, "ceil") %}

                        <div class="price mt-1">
                            <!-- Original price (strikethrough) -->
                            <span class="text-muted text-decoration-line-through me-2">
                                ₹{{ original }}
                            </span>

                            <!-- Discounted price -->
                            <span class="fw-bold text-danger">₹{{ item.price }}</span>

                            <!-- Discount badge -->
                            <span class="badge bg-success ms-2">{{ item.discount }}% OFF</span>
                        </div>

                    <!-- Normal price if no discount -->
                    {% else %}
                        <div class="price mt-1">
                            <span class="fw-bold text-dark">₹{{ item.price }}</span>
                        </div>
                    {% endif %}

                </div> <!-- /product info -->

            </div> <!-- /product card -->

        </div> <!-- /col -->
        {% endfor %}

    {% else %}
        <!-- ======================================================
             EMPTY CATEGORY (no products found)
        ======================================================= -->
        <div class="col-12">
            <div class="alert alert-info text-center py-4 fs-5">
                No products found in this category.
            </div>
        </div>

    {% endif %}

</div> <!-- /row -->

{% endblock %}
