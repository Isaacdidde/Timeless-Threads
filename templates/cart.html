{% extends "base.html" %}
{% block content %}

<!-- ==========================================================
     CART PAGE — Shows all cart items + order summary
========================================================== -->

<h2 class="fw-bold mb-4">Your Cart</h2>

{% if cart_items %}
<div class="row g-3">

  <!-- ======================================================
       LEFT SIDE — CART ITEMS LIST
       Each item shows:
         - Product image
         - Name, size, color, quantity
         - Line total
         - Remove button
  ====================================================== -->
  <div class="col-lg-8">

    {% for item in cart_items %}
    <div class="cart-item-card d-flex align-items-center justify-content-between mb-3 p-3 shadow-sm border rounded">

      <div class="d-flex align-items-center gap-3">

        <!-- PRODUCT IMAGE -->
        <img 
          src="{{ url_for('static', filename='images/products/' ~ item.product.image) }}" 
          alt="{{ item.product.name }}"
          style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;"
        />

        <!-- PRODUCT DETAILS (Name, size, color, quantity, price) -->
        <div>

          <!-- Name -->
          <h6 class="mb-1">{{ item.product.name }}</h6>

          <!-- Conditional Size -->
          {% if item.size %}
          <div class="small"><b>Size:</b> {{ item.size }}</div>
          {% endif %}

          <!-- Conditional Color -->
          {% if item.color %}
          <div class="small d-flex align-items-center">
            <b>Color:</b>

            <!-- Small square preview of the color -->
            <span
              class="color-preview"
              data-color="{{ item.color }}"
            ></span>

            <span class="ms-2">{{ item.color }}</span>
          </div>
          {% endif %}

          <!-- Quantity -->
          <div class="small text-muted mt-1">Qty: {{ item.quantity }}</div>

          <!-- Line total -->
          <div class="fw-bold text-danger mt-1">
            ₹{{ item.product.price }} × {{ item.quantity }} = ₹{{ item.total }}
          </div>

        </div>
      </div>

      <!-- ==================================================
           REMOVE ITEM BUTTON
           Uses product_id + size + color to identify variant
      ================================================== -->
      <a 
        href="{{ url_for(
          'product.remove_item',
          product_id=item.product._id|string,
          size=item.size or 'none',
          color=item.color or 'none'
        ) }}"
        class="btn btn-sm btn-outline-danger">
        Remove
      </a>

    </div>
    {% endfor %}

  </div>

  <!-- ======================================================
       RIGHT SIDE — ORDER SUMMARY CARD
       Shows:
         - Total items
         - Grand total
         - Checkout button
  ====================================================== -->
  <div class="col-lg-4">
    <div class="card p-3 shadow-sm">

      <h5 class="fw-bold">Order Summary</h5>
      <hr />

      <!-- Item count -->
      <div class="d-flex justify-content-between">
        <span>Items</span>
        <span>{{ cart_items|length }}</span>
      </div>

      <!-- Grand total (sum of all 'total' values) -->
      <div class="d-flex justify-content-between mt-2">
        <span class="fw-bold">Total</span>
        <span class="fw-bold text-danger">
          ₹{{ cart_items|sum(attribute='total') }}
        </span>
      </div>

      <!-- Checkout -->
      <a href="{{ url_for('product.checkout') }}" class="btn btn-dark w-100 mt-4">
        Proceed to Checkout
      </a>

    </div>
  </div>

</div>

{% else %}
<!-- ==========================================================
     EMPTY CART STATE
========================================================== -->
<div class="alert alert-secondary">Your cart is empty.</div>
<a href="{{ url_for('main.home') }}" class="btn btn-outline-dark">Continue Shopping</a>
{% endif %}

{% endblock %}
