{% extends "base.html" %}
{% block content %}

<h2 class="fw-bold mb-4">Your Cart</h2>

{% if cart_items %}
<div class="row g-3">

  <!-- LEFT: CART ITEMS -->
  <div class="col-lg-8">

    {% for item in cart_items %}
    <div class="cart-item-card d-flex align-items-center justify-content-between mb-3 p-3 shadow-sm border rounded">

      <div class="d-flex align-items-center gap-3">

        <!-- PRODUCT IMAGE -->
        <img 
          src="{{ url_for('static', filename='images/products/' ~ item.product.image) }}" 
          alt="{{ item.product.name }}"
          style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;"
        />

        <div>

          <!-- Name -->
          <h6 class="mb-1">{{ item.product.name }}</h6>

          <!-- Size -->
          {% if item.size %}
          <div class="small"><b>Size:</b> {{ item.size }}</div>
          {% endif %}

          <!-- Color -->
          {% if item.color %}
          <div class="small d-flex align-items-center mt-1">

            <b class="me-1">Color:</b>

            <!-- Color Preview Box -->
            <span
              class="color-preview"
              style="
                width:14px;
                height:14px;
                display:inline-block;
                background: {{ item.color }};
                border:1px solid #ccc;
                border-radius:3px;
                margin-left:6px;
              "
            ></span>

            <span class="ms-2">{{ item.color }}</span>

          </div>
          {% endif %}

          <!-- Qty -->
          <div class="small text-muted mt-1">Qty: {{ item.quantity }}</div>

          <!-- Line Total -->
          <div class="fw-bold text-danger mt-1">
            ₹{{ item.product.price }} × {{ item.quantity }} = ₹{{ item.total }}
          </div>

        </div>
      </div>

      <!-- REMOVE BUTTON -->
      <a 
        href="{{ url_for(
          'product.remove_item',
          product_id=item.product._id|string,
          size=item.size or 'none',
          color=item.color or 'none'
        ) }}"
        class="btn btn-sm btn-outline-danger">
        Remove
      </a>

    </div>
    {% endfor %}

  </div>

  <!-- RIGHT: ORDER SUMMARY -->
  <div class="col-lg-4">
    <div class="card p-3 shadow-sm">

      <h5 class="fw-bold">Order Summary</h5>
      <hr />

      <div class="d-flex justify-content-between">
        <span>Items</span>
        <span>{{ cart_items|length }}</span>
      </div>

      <div class="d-flex justify-content-between mt-2">
        <span class="fw-bold">Total</span>
        <span class="fw-bold text-danger">
          ₹{{ cart_items|sum(attribute='total') }}
        </span>
      </div>

      <a href="{{ url_for('product.checkout') }}" class="btn btn-dark w-100 mt-4">
        Proceed to Checkout
      </a>

    </div>
  </div>

</div>

{% else %}
<div class="alert alert-secondary">Your cart is empty.</div>
<a href="{{ url_for('main.home') }}" class="btn btn-outline-dark">Continue Shopping</a>
{% endif %}

{% endblock %}
